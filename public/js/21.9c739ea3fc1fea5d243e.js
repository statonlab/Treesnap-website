webpackJsonp([21],{"5zKI":function(e,t,a){"use strict";var n=a("U7vG"),r=a.n(n),s=a("O27J"),o=a.n(s),i=a("KSGD"),l=a.n(i),c=function(){function e(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,a,n){return a&&e(t.prototype,a),n&&e(t,n),t}}();var u=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var a=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return a.state={show:!1,hiding:!1,marginTop:window.scrollY>70?-40:0},a}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,n["Component"]),c(t,[{key:"componentWillMount",value:function(){var e=this;this.timer=setTimeout(function(){e.hide()},5e3)}},{key:"componentDidMount",value:function(){var e=this;setTimeout(function(){e.setState({show:!0})},100),window.addEventListener("scroll",this.handleWindowScroll.bind(this))}},{key:"componentWillUnmount",value:function(){window.removeEventListener("scroll",this.handleWindowScroll.bind(this))}},{key:"handleWindowScroll",value:function(){var e=window.scrollY>70?-40:0;this.setState({marginTop:e})}},{key:"hide",value:function(){this.setState({hiding:!0}),clearTimeout(this.timer)}},{key:"render",value:function(){var e="";switch(this.props.type){case"success":case"danger":case"info":case"warning":e="is-"+this.props.type;break;default:e="is-success"}e+=this.state.show?" show":"",e+=this.state.hiding?" hiding":"";var t=this.state.marginTop;return r.a.createElement("div",{className:"notification push-notification "+e,style:{marginTop:t+"px"}},r.a.createElement("button",{type:"button",className:"delete",onClick:this.hide.bind(this)}),this.props.message)}}],[{key:"_remove",value:function(){this.stack&&this.stack.length>0&&document.body.removeChild(this.stack.shift())}},{key:"push",value:function(e){var a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"success",n=document.createElement("div");o.a.render(r.a.createElement(t,{message:e,type:a,container:n}),n),document.body.appendChild(n),this.stack.length>0&&this._remove(),this.stack.push(n)}}]),t}();t.a=u,u.PropTypes={message:l.a.string.isRequired,type:l.a.string,container:l.a.object.isRequired},u.defaultProps={type:"success"},u.stack=[]},QyhV:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=a("U7vG"),r=a.n(n),s=a("KSGD"),o=a.n(s),i=a("saAw"),l=a("PJh5"),c=a.n(l),u=a("F8kA"),p=a("5zKI"),m=a("t4LX"),h=function(){function e(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,a,n){return a&&e(t.prototype,a),n&&e(t,n),t}}();var f=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var a=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return a.state={searchTerm:"",groups:[],loading:!1,joiningGroup:-1,seeMore:!1},a}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,n["Component"]),h(t,[{key:"componentWillMount",value:function(){this.search()}},{key:"search",value:function(e){var t=this;void 0!==e?this.setState({searchTerm:e}):e="",axios.get("/web/groups/search",{params:{term:e}}).then(function(e){t.setState({groups:e.data.data})}).catch(function(e){console.log(e)})}},{key:"join",value:function(e){var t=this;-1===this.state.joiningGroup&&(this.setState({joiningGroup:e.id,loading:!0}),axios.post("/web/groups/join/"+e.id).then(function(e){p.a.push(e.data.data),t.setState({joiningGroup:-1,loading:!1}),t.search(t.state.searchTerm)}).catch(function(e){if(t.setState({joiningGroup:-1,loading:!1}),e.response){var a=e.response;switch(a.status){case 404:p.a.push("Unknown group selected! Please select a valid group","danger");break;case 422:a.data.error?p.a.push(a.data.error,"danger"):p.a.push("Unknown error! Please try again later","danger");break;default:p.a.push("Internal server error! Please try again later","danger")}}else p.a.push("Network error! Please try again later","danger")}))}},{key:"render",value:function(){var e=this,t=this.state.seeMore?this.state.groups:this.state.groups.slice(0,4);return r.a.createElement("div",null,r.a.createElement("div",{className:"field mb-1"},r.a.createElement("div",{className:"control"},r.a.createElement("input",{type:"search",className:"input",placeholder:"Type to search...",onChange:function(t){var a=t.target;return e.search(a.value)},value:this.state.searchTerm}))),r.a.createElement("table",{className:"table has-text-vertically-centered"},r.a.createElement("tbody",null,0===t.length&&this.state.searchTerm.length>0?r.a.createElement("tr",null,r.a.createElement("td",{colSpan:3,className:"has-text-grey"},"No results found")):null,t.map(function(t){var a=e.state.joiningGroup===t.id?" is-loading":" is-outlined";return a+=t.has_request?" is-warning":" is-success",r.a.createElement("tr",{key:t.id},r.a.createElement("td",null,t.name),r.a.createElement("td",null,t.users_count," Members"),r.a.createElement("td",{className:"has-text-right"},r.a.createElement("button",{type:"button",className:"button is-small"+a,disabled:e.state.loading&&e.state.joiningGroup!==t.id,onClick:function(){return e.join(t)}},t.has_request?"Pending":"Join")))}))),this.state.groups.length>4?r.a.createElement("a",{href:"javascript:;",className:"is-block has-text-centered",onClick:function(){return e.setState({seeMore:!e.state.seeMore})}},this.state.seeMore?"See Less":"See More"):null)}}]),t}(),d=function(){function e(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,a,n){return a&&e(t.prototype,a),n&&e(t,n),t}}();var v=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var a=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return a.state={name:"",share:!1,isPrivate:0,errors:{share:[],name:[],isPrivate:[]},groups:[],success:!1,loading:!1},document.title="Groups - TreeSnap",a}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,n["Component"]),d(t,[{key:"componentWillMount",value:function(){var e=this;this.setState({loading:!0}),axios.get("/web/groups").then(function(t){var a=t.data.data;e.setState({groups:a,loading:!1})}).catch(function(t){console.log(t),e.setState({loading:!1})})}},{key:"_renderGroupsTable",value:function(){if(0===this.state.groups.length)return r.a.createElement("div",null,r.a.createElement("p",null,"There are no available groups yet. You can create a group using the form below."),r.a.createElement("p",null,"If someone else invites you to join their group, the group will show up here once you accept the invitation."));var e=this.props.admin;return r.a.createElement("table",{className:"table is-striped mb-none",id:"groups-table"},r.a.createElement("thead",null,r.a.createElement("tr",null,r.a.createElement("th",null,"Name"),r.a.createElement("th",null,"Users"),r.a.createElement("th",null,"Leader"),r.a.createElement("th",null,"Date Created"))),r.a.createElement("tbody",null,this.state.groups.map(function(t,a){return r.a.createElement("tr",{key:a},r.a.createElement("td",null,r.a.createElement(u.b,{to:(e?"":"/account")+"/group/"+t.id},t.name," ","You"===t.owner.name&&t.group_requests_count>0?r.a.createElement("i",{className:"tag is-success"},t.group_requests_count," pending requests"):null)),r.a.createElement("td",null,t.users_count),r.a.createElement("td",null,t.owner.name),r.a.createElement("td",null,c()(t.created_at).format("MMM Do, YYYY")))})))}},{key:"_renderForm",value:function(){var e=this;return r.a.createElement("form",{action:"#",onSubmit:this.submit.bind(this)},r.a.createElement("div",{className:"field"},r.a.createElement("label",{className:"label"},"Group Name"),r.a.createElement("div",{className:"control is-expanded"},r.a.createElement("input",{type:"text",className:"limit-width input"+(this.state.errors.name.length>0?" is-danger":""),value:this.state.name,placeholder:"Group Name",onChange:function(t){var a=t.target;return e.setState({name:a.value})}}),this.state.errors.name.map(function(e,t){return r.a.createElement("p",{className:"help is-danger",key:t},e)}))),r.a.createElement("div",{className:"field"},r.a.createElement("label",{className:"label"},"Discoverability"),r.a.createElement("div",{className:"control is-expanded"},r.a.createElement("span",{className:"select"},r.a.createElement("select",{value:this.state.isPrivate,onChange:function(t){var a=t.target;return e.setState({isPrivate:parseInt(a.value)})}},r.a.createElement("option",{value:1},"Users must be invited to join"),r.a.createElement("option",{value:0},"Allow anyone to find this group and apply to join"))),this.state.errors.isPrivate.map(function(e,t){return r.a.createElement("p",{className:"help is-danger",key:t},e)}))),r.a.createElement("div",{className:"field"},r.a.createElement("div",{className:"control"},r.a.createElement("label",{className:"checkbox"},r.a.createElement("input",{type:"checkbox",className:"mr-0",onChange:function(t){var a=t.target;return e.setState({share:a.checked})},checked:this.state.share}),r.a.createElement("span",null,"Share all of my observations with members of this group including accurate location coordinates"))),this.state.errors.share.map(function(e,t){return r.a.createElement("p",{className:"help is-danger",key:t},e)})),r.a.createElement("div",{className:"field"},r.a.createElement("div",{className:"control"},r.a.createElement("button",{type:"submit",className:"button is-primary"},"Create Group"))))}},{key:"submit",value:function(e){var t=this;e.preventDefault(),axios.post("/web/groups",{name:this.state.name,share:this.state.share,is_private:1===this.state.isPrivate}).then(function(e){var a=e.data.data,n=t.state.groups;n.push(a),t.setState({name:"",groups:n,errors:{name:[],share:[],isPrivate:[]}}),p.a.push("Group created successfully."),m.a.emit("user.groups.updated")}).catch(function(e){if(e.response&&422===e.response.status){var a=e.response.data;t.setState({errors:{name:a.name||[],share:a.share||[],isPrivate:a.is_private||[]}})}})}},{key:"render",value:function(){return r.a.createElement("div",null,r.a.createElement("h1",{className:"title is-3"},"User Groups"),r.a.createElement("div",{className:"box"},r.a.createElement("h4",{className:"title is-4"},"Groups"),this._renderGroupsTable()),r.a.createElement("div",{className:"columns is-multiline"},r.a.createElement("div",{className:"column is-12-tablet is-6-desktop is-6-fullhd"},r.a.createElement("div",{className:"box"},r.a.createElement("h2",{className:"title is-4"},"Create New Group"),this._renderForm())),r.a.createElement("div",{className:"column is-12-tablet is-6-desktop is-6-fullhd"},r.a.createElement("div",{className:"box"},r.a.createElement("h2",{className:"title is-4"},"Join a Group"),r.a.createElement("p",{className:"mb-1"},"Search and apply to join public groups"),r.a.createElement(f,null)))),r.a.createElement(i.a,{visible:this.state.loading}))}}]),t}();t.default=v;v.PropTypes={admin:o.a.bool},v.defaultProps={admin:!0}},saAw:function(e,t,a){"use strict";var n=a("U7vG"),r=a.n(n),s=a("KSGD"),o=a.n(s),i=function(){function e(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,a,n){return a&&e(t.prototype,a),n&&e(t,n),t}}();var l=function(e){function t(e){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,n["Component"]),i(t,[{key:"render",value:function(){return this.props.visible?this.props.inline?r.a.createElement("div",{className:"mt-1",style:this.props.containerStyle},r.a.createElement("i",{className:"fa fa-refresh fa-spin fa-2x"})):r.a.createElement("div",{className:"spinner-overlay",style:this.props.containerStyle},r.a.createElement("div",{className:"overlay-blur"}),r.a.createElement("span",{className:"spinner-container"},r.a.createElement("i",{className:"is-loading"}))):null}}]),t}();t.a=l,l.PropTypes={visible:o.a.bool.isRequired,containerStyle:o.a.object,inline:o.a.bool},l.defaultProps={containerStyle:{},inline:!1}}});